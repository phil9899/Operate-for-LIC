#include <Stepper.h>

const int stepsPerRevolution = 2048;
const int motorSpeed = 15;  // Motor speed (RPM)

Stepper myStepper(stepsPerRevolution, 8, 10, 9, 11);

const unsigned long runTime = 30UL * 60 * 1000; // 30 minutes

const int buttonPin = 2;          // Button pin (active LOW)
bool motorRunning = false;
bool lastButtonState = HIGH;
unsigned long startTime = 0;

void setup() {
  myStepper.setSpeed(motorSpeed);
  pinMode(buttonPin, INPUT_PULLUP);
}

void loop() {
  bool currentState = digitalRead(buttonPin);

  // Detect button press (active LOW)
  if (currentState == LOW && lastButtonState == HIGH) {
    if (motorRunning) {
      motorRunning = false;          // Stop if running
    } else {
      motorRunning = true;           // Start running
      startTime = millis();
    }
    delay(50);                      // Simple debounce
  }
  lastButtonState = currentState;

  if (motorRunning) {
    unsigned long elapsed = millis() - startTime;
    if (elapsed >= runTime) {
      motorRunning = false;         // Stop after 30 minutes
    } else {
      myStepper.step(1);            // Run at constant speed
    }
  }
}
